sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/ui/core/Fragment","sap/m/MessageToast","sap/ui/core/BusyIndicator"],function(e,t,r,i,n,l,o,a){"use strict";const p="VIRTUAL";const s="MP";const u="PT";return e.extend("cuprum.zmm_ptplayouts.BaseController",{get_VE_layout:function(){return[{label:"Factura",property:"Vbeln",width:10,type:"String"},{label:"Fecha",property:"Fecha",width:10,type:"String"},{label:"Orden Compra",property:"Ebeln",width:10,type:"String"},{label:"Cliente",property:"Kunnr",width:10,type:"String"},{label:"Cuprum",property:"Parnr",width:10,type:"String"},{label:"Figura",property:"description_parnr",width:10,type:"String"},{label:"Fracción Arancelaria",property:"ccngn",width:10,type:"String"},{label:"Descripción",property:"description_parnr",width:10,type:"String"},{label:"Descripcion Pedimento",property:"description_ped",width:10,type:"String"},{label:"Piezas",property:"fkimg",width:10,type:"String"},{label:"Kilos",property:"brgew",width:10,type:"String"},{label:"Libras",property:"menge",width:10,type:"String"},{label:"Metros",property:"laeng",width:10,type:"String"},{label:"Pies",property:"menge_ft",width:10,type:"String"},{label:"UM",property:"vrkme",width:10,type:"String"},{label:"Unitario USD",property:"wavwr",width:10,type:"String"},{label:"Total USD",property:"netwr",width:10,type:"String"}]},get_MP_layout:function(){return[{label:"No. PARTE",property:"Parnr",width:10,type:"String"},{label:"DESCRIPCION",property:"description",width:10,type:"String"},{label:"FRACCION ARANCELARIA",property:"ccngn",width:10,type:"String"},{label:"FA DESPERDICIO",property:"fa_desper",width:10,type:"String"},{label:"UM COMERCIAL",property:"lmein",width:10,type:"String"},{label:"UM TARIFA",property:"um_tarifa",width:10,type:"String"},{label:"TIPO MP",property:"tipo_mp",width:10,type:"String"},{label:"CATEGORIA IMMEX",property:"category_immex",width:10,type:"String"},{label:"PAIS ORIGEN",property:"country",width:10,type:"String"},{label:"COSTO UNITARIO",property:"netpr",width:10,type:"Number"},{label:"PESO EN KGS",property:"menge",width:10,type:"Number",unit:"kg"},{label:"REFERENCIA",property:"reference",width:10,type:"String"},{label:"OBSERVACIONES",property:"observations",width:10,type:"String"}]},get_PT_layout:function(){return[{label:"No. PARTE",property:"Parnr",width:10,type:"String"},{label:"DESCRIPCION",property:"Text",width:10,type:"String"},{label:"DESCRIPCION EN INGLES",property:"description_en",width:10,type:"String"},{label:"CATEGORIA1",property:"category1",width:10,type:"String"},{label:"FRACCION ARANCELARIA",property:"ccngn",width:10,type:"String"},{label:"FA DESPERDICIO",property:"fa_desper",width:10,type:"String"},{label:"UM COMERCIAL",property:"lmein",width:10,type:"String"},{label:"UM TARIFA",property:"um_tarifa",width:10,type:"String"},{label:"PAIS DESTINO",property:"country",width:10,type:"String"},{label:"COSTO UNITARIO",property:"netpr",width:10,type:"String"},{label:"PESO EN KGS",property:"menge",width:10,type:"String"},{label:"REFERENCIA",property:"reference",width:10,type:"String"},{label:"OBSERVACIONES",property:"observations",width:10,type:"String"},{label:"FECHA ESTRUCTURA",property:"fecha_es",width:10,type:"String"},{label:"No. PARTE DEL COMPONENTE",property:"comp_parnr",width:10,type:"String"},{label:"UNIDAD COMPONENTE",property:"comp_unid",width:10,type:"String"},{label:"CANTIDAD INCORPORADA",property:"incorp_cant",width:10,type:"String"},{label:"CANT. MERMA",property:"merma_Cant",width:10,type:"String"},{label:"CANT. DESPERDICIO",property:"desper_Cant",width:10,type:"String"},{label:"FDESDE",property:"fdesde",width:10,type:"String"},{label:"FHASTA",property:"f_hasta",width:10,type:"String"}]},get_Resource_Bundle:function(){return this.getView().getModel("i18n").getResourceBundle()},getRequestModel(){return new t({Global:{dateFrom:"",dateTo:"",sociedad_inicio:"",sociedad_fin:"",showSociedad:true,material_inicio:"",material_fin:"",showMaterial:true,tableEV:true,tablePT:false,tableMP:false},Virtual:{factura_inicio:"",factura_fin:"",showFacturas:true,oc_inicio:"",oc_fin:"",showOC:true,cliente:"",showCliente:true},MP:{proveedor:"",sowProveedor:false,numParte:"",showNumParte:false},PT:{}})},getCountFromOData:function(e,t,r){return new Promise((i,n)=>{e.read(t+"/$count",{filters:r,success:function(e,t){const r=parseInt(oResponse?.body||oResponse?.responseText||"0");i(r)},error:n})})},readODataPaginated:async function(e,t,r,i){let n=[];let l=true;while(l){const o=await new Promise((n,l)=>{e.read(t,{filters:r,urlParameters:{$top:i},success:n,error:l})});n=n.concat(o.results||[]);if(o.__next){t="/"+o.__next.split("/").slice(-1)[0]}else{l=false}}return n},loadFilterEntities:async function(e,t){const r=this;const i=this.getUrlFilters(e);let l=[];async function o(e,r){return new Promise((i,n)=>{t.read(e,{filters:r,success:function(e,t){const r=parseInt(e);i(r)},error:n})})}async function a(e,r=false,i=5e3){return new Promise((n,l)=>{const o={success:n,error:l};if(r){o.filters=aFilters;o.urlParameters={$top:i}}t.read(e,o)})}try{let t=i[0].url;let d=i[0].urlCount;const g=i[0].filters;const y=await o(d,g);let S=true;let h=true;while(S){const e=await a(t,h,y);h=false;l=l.concat(e.results||[]);if(e.__next){console.log("Next URL:",e.__next);const r=e.__next.split("/Set?")[1];const n="/ZZ1_CDS_LAYOUT_EV(p_fecha='"+i[0].fecha+"')/Set?"+r;t=n}else{S=false}}const w=new sap.ui.model.json.JSONModel;w.setData(l);console.log(l);var c=this.get_Resource_Bundle();let f=c.getText("sinResultados");let _=c.getText("sinResultados");if(l.length>0){if(e===p){r.getView().setModel(w,"evLayoutModel")}else if(e===s){r.getView().setModel(w,"mpLayoutModel")}else if(e===u){r.getView().setModel(w,"ptLayoutModel")}}else{n.warning(f)}}catch(e){console.log("Error al cargar el layout:",e);const t=this.get_Resource_Bundle();let r=t.getText("sinResultados");n.error(r)}},getUrlFilters:function(e){var t=this.getView().getModel("requestModel").getData();var n=[];var l,o;let a=new Date(t.Global.dateFrom);let c=parseInt(a.getMonth())+1;c=c<=9?"0"+c.toString():c.toString();let d=parseInt(a.getDate());d=d<=9?"0"+d.toString():d.toString();let g=a.getFullYear().toString()+c.toString()+d;let y=new Date(t.Global.dateTo);let S=parseInt(y.getMonth())+1;S=S<=9?"0"+S.toString():S.toString();let h=parseInt(y.getDate());h=h<=9?"0"+h.toString():h.toString();let w=y.getFullYear().toString()+S.toString()+h;let f=g+"|"+w;var _=[];var b=t.Global.sociedad_inicio;var E=t.Global.sociedad_fin;var C=t.Global.material_inicio;var m=t.Global.material_fin;if(e===p){l="/ZZ1_CDS_LAYOUT_EV(p_fecha='"+f+"')/Set?";o="/ZZ1_CDS_LAYOUT_EV(p_fecha='"+f+"')/Set/$count?";var A=t.Virtual.factura_inicio;var P=t.Virtual.factura_fin;var M=t.Virtual.oc_inicio;var T=t.Virtual._oc_fin;var I=t.Virtual.cliente;if(A&&!P){_.push(new r("Vbeln",i.EQ,A))}else if(A&&P){_.push(new r("Vbeln",i.BT,A,P))}if(M&&!T){_.push(new r("Ebeln",i.EQ,M))}else if(M&&T){_.push(new r("Ebeln",i.BT,M,T))}if(C&&!m){_.push(new r("Parnr",i.EQ,C))}else if(C&&m){_.push(new r("Parnr",i.BT,C,m))}if(I){_.push(new r("Kunnr",i.EQ,I))}}else if(e===s){l="/ZZ1_CDS_LAYOUT_MP(p_fecha='"+f+"')/Set?";o="/ZZ1_CDS_LAYOUT_MP(p_fecha='"+f+"')/Set/$count?";let e=t.MP.numParte;let n=t.MP.proveedor;if(e){_.push(new r("Parnr",i.EQ,e))}if(n){_.push(new r("Lifnr",i.EQ,n))}}else if(e===u){l="/ZZ1_CDS_LAYOUT_PT(p_fecha='"+f+"')/Set?";o="/ZZ1_CDS_LAYOUT_PT(p_fecha='"+f+"')/Set/$count?";if(C&&!m){_.push(new r("Parnr",i.EQ,C))}else if(C&&m){_.push(new r("Parnr",i.BT,C,m))}}if(b&&!E){_.push(new r("Bukrs",i.EQ,b))}else if(b&&E){_.push(new r("Bukrs",i.BT,b,E))}debugger;n.push([{url:l,filters:_,urlCount:o}]);return n[0]},getColums:function(e){var t;if(e===p){t=this.getView().getModel("veColumnsModel").getData()}else if(e===s){t=this.getView().getModel("mpColumsModel").getData()}else if(e===u){t=this.getView().getModel("ptColumnsModel").getData()}return t},destroyModel:function(e,t){const r=t||this.getView();const i=r.getModel(e);if(i){i.destroy();r.setModel(null,e);console.log(`[BaseController] Modelo "${e}" destruido.`)}else{console.warn(`[BaseController] No se encontró el modelo "${e}" para destruir.`)}},showBusy:function(e){a.show(e||0)},hideBusy:function(){a.hide()}})});
//# sourceMappingURL=BaseController.js.map